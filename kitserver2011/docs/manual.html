<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="Content-Language" content="en">
    <title>Kitserver 2011 Manual</title>
    <style>
        img { display:block;margin:10px 15px 15px 0;border:1px solid #888;}
        table td img {border:0}
        .note { background-color:#ffc;color:#800; }
        div.note { padding:5px; }
        p.minornote { background-color:#eee;color:#666;padding:5px;font-style:italic }
        .devnote { font-weight:bold;font-style:italic;color:#666; }
        table {padding:10px 0 10px 0;margin-top:5px;border-right:1px;border-bottom:1px}
        table td {padding:9px;border:1px solid #888}
        table th {padding:5px;border:1px solid #888;background-color:#ddf;text-align:left}
        table.stad_names {padding:0;border-right:1px solid #888;border-bottom:1px solid #888;margin-bottom:20px;}
        table.stad_names th {font-size:0.8em;}
        table.stad_names td {font-size:0.8em;}
        table.stad_names th {padding:5px;border-left:1px solid #888;border-top:1px solid #888;border-right:none;border-bottom:none}
        table.stad_names td {padding:5px;border-left:1px solid #888;border-top:1px solid #888;border-right:none;border-bottom:none}
        span.kitid {color:#080;font-style:italic}
        pre {background-color:#ddf;border-top:1px solid #668;border-bottom:1px solid #668}
        h5 {color:#444; background-color:#eee; display:block;padding:5px;margin-top:10px;margin-bottom:5px;font-family:arial;font-size:1.0em}
        h6 {color:#444; background-color:#eee; display:block;padding:5px;margin-top:10px;margin-bottom:5px;font-family:arial;font-size:0.8em}
        h3,h4 {color:#630; background-color:#cdc;display:block;padding:5px;font-family:arial;margin-top:1.3em;}
        h2 {color:#659; display:block;padding:5px 0 5px 0;font-family:tahoma,arial;border-bottom:3px solid #659}
        div,span,p,li {font-family:arial;}
        li {margin-bottom:10px;}
        table {font-family:arial;}
        table.shpal td {padding:5px 20px 5px 0;border-bottom:1px solid #000;
            border-top:none;border-left:none;border-right:none}
        table.shpal td.top {border-top:1px solid #000}
        span.soft {font-weight:bold;color:#696;}
        span.ex {font-weight:bold;color:#669;}
        a {color:#448;}
        a:visited {color:#448;}
        a:hover {color:#448;background-color:#ccf}
        a:active {color:#448;}
        tr.newf td {background-color:#efd}
        span.exclam {font-weight:bold;color:#484;}
        span.emph {color:#844;}
        span.emph2 {color:#822;font-weight:bold;}
        div.hist {color:#888;float:right;}
        span.buttontext {font-weight:bold;color:#000;background-color:#888}
        a.ac{font-weight:bold;}
        a.backlink {float:right;margin-top:0.6em}
    </style>
</head>
<body>
<h2>Kitserver 2011 Manual</h2>

<div class="hist">
Version history: <a href="history.txt">history.txt</a><br />
</div>
<div>
    October 11, 2010 - <b>Kitserver 10.0.2</b> 
</div>
<p class="note">
Usually, the most up-to-date version of this documentation, and the translations to many languages, are located here: <a href="http://kitserver.ath.cx/docs/">http://kitserver.ath.cx/docs/</a>. Documentation for Kitservers 5-8 and Kitserver 2010 can also be found there.
</p>

<!--
<img style="border:0;align:left;display:inline;float:right" src="kslogo.png"/>
-->
<h3>1. Introduction</h3>
<p>
Kitserver 2011 is an add-on program for Pro Evolution Soccer 2011 (and Pro Evolution Soccer 2011 DEMO). It is a loader and manager for various modules, where
each module is built as a (typically) independent DLL containing logic to 
enhance the game in particular aspect. While originally the Kitserver was 
developed to "serve" kits Pro Evolution Soccer 3, a lot more functionality 
has been added over the years.<br />
Below is a quick summary of the available features. Follow the link in the left column to get more details about a particular module.
</p>

<p>
If you are new to Kitserver, please make sure you read the
<a href="#install">installation instructions</a>.
</p>

<p>
<table>
    <tr><td><a href="#afs2fs">AFS2FS 10.0.2</a></td>
        <th><b>afs2fs.dll</b></th>
        <td>Manage AFS (.img) game content using files and folders: much easier and quicker to install/remove patches, without the need modify *.img files.</td>
    </tr>
    <tr><td><a href="#speeder">Speeder module 10.0.1</a></td>
        <th><b>speeder.dll</b></th>
        <td>Increase or decrease gameplay speed.</td>
    </tr>
</table>
</p>

<a name="install">
<p><a class="backlink" href="#">Top</a></p>
<h3>2. Installation / Removal</h3>
</a>

<h5>2.1. Install</h5>

<p>
With XP and Vista, and now Windows 7 having more emphasis and enforcement of file ownership and 
different user rights, and promoting the use of "Standard User" accounts, i realized it was time 
to change the installation routine slightly, compared
to the previous versions of Kitserver. So, first new thing: you have a more traditional installer
now, well it's just a self-extractable archive with some logos :) Run it, and it will ask you
where you want your kitserver files extracted:
</p>

<img src="installer.png"/>

<p>You can leave the default directory specified in the installer, or you can put in your own.
The important thing is that you unpack the files into a place where you have full control
over the files (your HOME directory is one example of that.) This will ensure that you 
won't run into any File Virtualization surprises on Vista, and also that <b>you will NOT 
    need administrative privileges</b> to run the game with Kitserver. 
</p>

<p>Now go to that directory that you installed your kitserver to. You will see there
a folder named <b>Kitserver2011</b>. Open that folder, you should see something like this:

<img src="layout1.png"/>

<p>
Now, copy the two executables from your game folder to the Kitserver2011 folder - <b>pes2011.exe</b> and <b>settings.exe</b>. (<span class="devnote">Depending on your Windows settings, you may see them 
as simply <b>pes2011</b> and <b>settings</b> - with file extensions hidden. 
In fact, by default the file extensions of known file types are hidden, as you can see 
on the screenshot below).</span> So, now it should look like this:
</p>

<img src="layout2.png"/>

<p>Almost there! A couple more steps and we'll have the game running with Kitserver.<br />
Now open the <b>kitserver</b> folder and run the <b>manager.exe</b> program. 
</p>
<p><span class="devnote">This was previously called setup.exe, but Windows thinks that any
application named setup.exe wants administrative access, even though the kitserver's 
setup actually doesn't. Also, the name "setup" was always slightly misleading, so 
i decided to rename it to more neutral - manager - because it manages the attachment
of kitserver to the game EXE files.</span></p>

<img src="layout3.png"/>

<p>
Now select the game executable (it should actually already be preselected). You can
also select your settings.exe (if say you wish to by-pass the quality 
checks, for example. Otherwise, it is not necessary). 
Once you select the files, click <b>"Attach"</b> button.
What this does is it "connects" the kitserver to the game: now whenever you start the game (using that particular game EXE), the Kitserver DLLs will be loaded into memory. If all went well, you should see a picture like this:
</p>

<img src="manager.png"/>

<p>
If you decide that you don't want to use Kitserver any longer, run manager.exe again and click <b>"Detach"</b>, and it will disconnect the kitserver from the game EXE. 
<span class="devnote">(This is useful when troubleshooting
crashes: you can always temporarily detach Kitserver from the game to verify that the game
runs fine without it. And then re-attach the Kitserver later).</span>
You can also install/remove Kitserver
only for one exe by setting the other one to "no action".
</p>

<p>Now for one last step, before we can run the game with kitserver:<br />
<span class="note">We need to make sure there exists a file called <b>config.txt</b> in the kitserver folder. 
</p>

<p>That's it. You're ready to launch the game.<br />
<span class="note">REMEMBER: you need to start the game using the game EXE (pes2011.exe) in Kitserver2011 folder, because that is the one that has the kitserver attached to it.</span>
</p>

<p class="devnote">For folks who had been using kitserver for some time, it is worth noting that
it is still possible to install the kitserver the "old" way: in the game folder. Everything would
still work fine, as long as you do everything as Administrator: run config.exe, run manager.exe,
and you have to run the game as administrator too. I would honestly not recommend doing that, but
instead adopt the new way. It is safer and you don't need to worry about administrative privileges,
and you don't run into File Virtualization issues which can lead to nasty surprises, and many
hours spent muttering things like: "why does my config.txt show correct setting, but in the
game i don't see the effect? What is going on?!!..."</p>

<h5>2.2. Uninstall</h5>

<p>Uninstall is very easy: just delete the <b>Kitserver2011</b> folder, and that's it.<br /> Kitserver 
doesn't write into system folders, or anything of that sort, so removal is very simple.
</p>

<p>Also, it is worth reminding that you can always temporarily detach the kitserver from the game exe, and then re-attach it back, by using the manager program (as described in 2.1 section above). This is 
useful when suddenly you get game crashes, and you are not sure whether Kitserver is at fault, or
there is some other reason.</p>

<h5>2.3. Installing KONAMI patches</h5>

<p>From time to time, Konami releases patches to the game. There is already 1.01 and 1.02 patches,
and there probably will be more released in the future. When you install these patches, you get
a brand new game executable (pes2011.exe) among other things. It is important to realise that 
Konami patch doesn't now about your Kitserver installation, and therefore the game EXE in your 
<b>Kitserver2011</b> folder will still be the old one.</p>

<p>So what you need to do is copy the new game EXE over to the Kitserver2011 folder, then run the
<b>manager.exe</b> program and attach the kitserver to the new EXE. Assuming, of course, that Kitserver
supports the new EXE, that's all there is to it. Now you can again start the game from Kitserver2011
folder.
</p>

<h5>2.4. Advanced usage of manager.exe</h5>
<p>
The kitserver <b>manager.exe</b> program can also be run without GUI - in a so-called batch or command-line mode. This can be useful, if kitserver is part of a bigger patch, which contains an installer, and typically the last step of the installer is to attach kitserver to the game EXE file. This can be accomplished by running the manager like this:
</p>

<p class="devnote">
manager --install --gfile={game-exe} --sfile={settings-exe}<br />
manager --remove --gfile={game-exe} --sfile={settings-exe}<br />
</p>
<p>Example:</p>
<p>
<b>manager --install --gfile=..\pes2011.exe --sfile=..\settings.exe</b>
</p>

<h5>2.5. config.txt</h5>
<p>Kitserver uses a file called <b>config.txt</b> as its main configuration file. A lot of things are specified there, including which modules
to load, what settings those modules should use, and etc. Go to your <b>kitserver</b> folder and you should see a file called <span class="devnote">config-sample.txt</span>. (I gave it
a different name on purpose: so that those who upgrade their kitserver installation don't accidently overwrite their existing config.txt). If you aren't
upgrading then the chances are that you don't have an existing config.txt, in which case just rename (or copy) the sample config into <b>config.txt</b> (or run <a href="#config">configuration tool</a>, click "Save" and it will do the same thing). Otherwise
you may want to compare the sample config with yours and see if you need to make changes to your config: such as add new modules in the [kload] section,
for example.</p>
<p class="note">Remember: if you don't have config.txt in your kitserver folder, kitserver will not do much. But it will log the fact that it couldn't find the config.txt. So if you think kitserver doesn't work for you, check the pes2011.log file for error messages</p>

<p><a class="backlink" href="#">Top</a></p>
<h3>3. Usage and configuration</h3>

<h5>3.1. Main configuration file: config.txt</h5>

<p>The main configuration file for kitserver - config.txt - is located in the
kitserver folder. If you don't have it there - re-read the end of Install section (2.1) above.
Here is an example of what can be in config.txt:
</p>

<pre>
[afs2fs]
img.dir = "c:\mypesfiles\root1"

[kload]
dll = afsio.dll
dll = afs2fs.dll
dll = speeder.dll

</pre>

<p>
Each module can have its own configuration section, which starts with <b>[<i>module-name</i>]</b>, and typically has one or more options following it. Now, normally you wouldn't need to modify config.txt file, except for the cases, when you need to modify the behaviour of a particular module (DLL), or enable/disable such DLL.
</p>

<p>To disable a particular module - just comment out the corresponding line in the <b>[kload]</b> section by putting a '#' symbol at the beginning. (Or you can delete that line altogether.)
</p>

<p class="note">The order of the DLLs is important. In particular: 
<b>afsio.dll</b> must be loaded before <b>afs2fs.dll</b>.
Only in very rare situations you should try re-arranging the DLLs.
</p>

<a name="afs2fs"><br /></a>
<p><a class="backlink" href="#">Top</a></p>
<h3>4. AFS2FS Module (afs2fs.dll)</h3>

<p>
This module allows to organize your BIN-files into folders on disk, instead of inserting them into AFS(*.img) files, which is sometimes a pain, and may require a lot of extra disk space.
</p>

<p>Several people over the last few years had suggested similar solutions, but ultimately it was <b>Str@teG</b> who kept talking about this idea of organizing BINs into folders, and eventually i decided to just go ahead and do it. So now this is realized in the this module - afs2fs.dll. From personal experience, i know that people are sometimes reluctant to install big patches that require an AFS-rebuild, not because it's particularly difficult or anything, but because it can be time-consuming and disk-space-hungry. With afs2fs, this is now very easy: you just put the BIN into correct folder and that's it. And, of course, there are no size constraints - the bins can be as large as needed!
</p>

<p>The module is also handy, when you want to try a patch without risking
totally destroying the content that you already have. Putting a new patch into
a separate AFS-root and modifying config.txt is all you need to get it going.
Removal as easy too: delete the correspoding "img.dir" line in config.txt, and
then delete the AFS-root folder. Multiple patches is no longer a management nightmare :). (See more info on AFS-roots in the sections below)</p>

<h5>4.1. How to set up the folders</h5>

<p>
Start by choosing a location where you would be putting your files. 
For example, let's take <b>c:\mypesfiles\root1</b>. This will be your so-called
AFS-root. Inside that folder, create a folder called <b>img</b>. (This is 
very important that you have the folder named "img", since the game relies
on particular names). Then, inside <b>img</b>, create folders, as needed, 
named - <b>dt00.img</b>, <b>dt01.img</b>, <b>dt0b.img</b>, and so for. 
That's where you're going to be putting the BIN-files. 
</p>

<p class="note">It's important to name the folders correctly: a folder must 
have exactly the same name as the corresponding AFS-file. For instance, 
if you call a folder dt00, instead of dt00.img, things will not work.
</p>

<p>This is how my <b>img</b> folder looks:

<img src="afs2fs.png"/>
</p>

<h5>4.2. How to name the files</h5>

<p class="devnote">In general, you can name the files whichever way you want, but you must follow one rule: there must be a BIN number in the name, and it must be preceded by an underscore character ('_'). Also, the filenames CANNOT be longer than 63 characters.
</p>

<p>
Examples of correctly named files:<br /><br />
<span style="color:#080;font-weight:bold">unknown_317.bin</span><br />
<span style="color:#080;font-weight:bold">goalnet_41.bin</span><br />
<span style="color:#080;font-weight:bold">ball_9.bin</span><br />
<span style="color:#080;font-weight:bold">unknow_9</span> (.bin extension is optional)<br />
<span style="color:#080;font-weight:bold">music_11.adx</span> (a file can have a different extension: .adx is typically used for music and sound files)<br />
</p>

<p>
Examples of incorrectly named files:<br /><br />
<span style="color:#800;font-weight:bold">unnamed10.bin</span> - no underscore symbol before the BIN number.<br />
<span style="color:#800;font-weight:bold">face.bin</span> - no BIN number.<br />
</p>

<h5>4.3. AFS roots</h5>
<p>
By default, the AFS2FS module will not search any "special" default paths. Instead you must specify your AFS roots explicitly: In <b>[afs2fs]</b> section of config.txt, you can speficy the location of your root, which can be anywhere on your hard disk. You can also have multiple roots, which is very useful if you have several patches, and you don't want to lose track of which BINs came from which patches (so that you can easily uninstall a patch by just deleting its root folder). 
</p>

<p>Here is an example with 3 different roots are configured:</p>

<pre>
[afs2fs]
img.dir = "c:\mypesfiles\root1"
img.dir = "patch-RPL"
img.dir = "afs-root3"
</pre>

<p>
The order of the roots is significant, when it comes to resolving "collisions". Say, you have a <b>dt0b.img/ball_9.bin</b> in the second root (patch-RPL), and <b>dt0b.img/superball_9.bin</b> in the third root (afs-root3). Even though the files are actually named differently, they intend to replace the same BIN - #9 from dt0b.img, and therefore we have a "collision". <span class="devnote">The rule is simple: the lower root in the list wins.</span> Which means that in this situation, the <b>dt0b.img/superball_9.bin</b> file will be used, since its root is listed last in the [afs2fs] section.</p>

<p class="note">IMPORTANT thing to remember: 
The root is the folder that <i>contains</i> "img", not the "img" folder itself. In other words, if the full pathname is <b>c:\mypesfiles\root1\img"</b>, then in the config.txt you should have: <b>img.dir = "c:\mypesfiles\root1"</b>
</p>

<h5>4.4. Names for balls and songs</h5>
<p>
When replacing songs with AFS2FS, it is also possible to change the title of the song and the artist's name, by using a <b>songs.txt</b> map-file, which should be put into afs-root folder.<br />
<br />
Here's an example of such songs.txt file:
</p>

<pre>
# Song names map
# Format: &lt;binId&gt;, "&lt;title&gt;", "&lt;artist&gt;" 
# Note that double quotes are required.

44, "I'm mad about you", "Sting"
45, "Вне зоны доступа", "Город 312"
</pre>

<p class="devnote" style="font-weight:normal">IMPORTANT: as with all other map-files and config files that Kitserver uses, 
the encoding of the file needs to be <b>Utf-8</b> or <b>Unicode</b>, especially
of you use non-latin symbols - like in the example above. (<b>ANSI</b> encoding
is ok if you only use Latin-1 characters.)
</p>

<p>
Similarly with balls, if you are replacing ball BINs, you probably want to
adjust their names too. One easy way to do that is to use a <b>balls.txt</b> map-file, which should be put into afs-root folder:

<pre>
# Ball names map
# Format: &lt;ball-number&gt;, "&lt;name&gt;"
# Note that double quotes are required.
# (Ball numbers go from 1 to 16)

8, "Nike-ball Blue"
9, "Мячик плохонький"
</pre>

<p>It is worth noting that each afs-root folder can have its own songs.txt
and balls.txt. Since each afs-root may contain music files and ball files,
it makes sense to tie the names to them this way. If you have multiple afs-roots(as when for example you have multiple patches, and each patch uses its own
afs-root), then the "conflicts" are resolved the same way as they are with BINs (see above for details). In other words, if one afs-root has name for song 11, and another afs-root has a name for song 11, then whichever afs-root is specified lower in the list (in config.txt) - will win.</p>

<p>Here's a picture to clarify where <b>songs.txt</b> and <b>balls.txt</b> files should be placed. In this case "root1" is my afs-root:

<img src="names.png"/>
</p>

<a name="speeder"><br /></a>
<p><a class="backlink" href="#">Top</a></p>
<h3>9. Speeder module (speeder.dll)</h3>

<p>Not everyone is satisfied with the pace of the gameplay. It must be said
that it is not an easy thing to get this aspect of simulating a football 
match correctly. Many factors are in play, and a lot depends on hardware. 
Personally, i think Konami did a decent job at that, but many folks find
the gameplay too fast.</p>

<p>Several techniques of slowing the game down exist, and not one of them
is perfect, but all work to some extent. The speeder module basically slows
down the clock, sort of tricking the game into running slower. This is not
an ideal solution either, but if a small adjustment is used, it can still
look real, play well, and actually provide a smoother gameplay. Don't
consider it a silver bullet though. It might work well for you, but it 
also may not deliver everything you had hoped for :) (One side-effect,
for example, is that if you set your match time to 10 minutes, but you
have the Game Speed set to 0.9, the actual match time will be approximately
11.1 minutes.)</p>

<p>It is possible to decrease the game speed and also to increase it.
The value <b>1.0</b> gives the default unchanged speed. Less than 1.0 - slower
gameplay, greater than 1.0 - faster gameplay. <span class="devnote">It is not advised to use values lower than 0.7, because the music/commentary starts to break up. Also values larger than 2.5 are not supported. It is already ridiculously fast with 2.5!</span>. You can set the game speed adjustment in config.txt, 
by using <b>count.factor</b> setting:

<pre>
[speeder]
count.factor = 0.95
</pre>
</p>


<div style="height:20px"></div>

<h2>Credits</h2>
<p>
Programming: <b>juce</b>, <b>Robbie</b> and <b>Stelios</b><br />
Beta-testing: members and guests of Evo-Web and PesWe.com forums.<br />
</p>

<p>Kitserver license is BSD-style license that can be found here:
<a href="license.txt">license.txt</a>
</p>

</body>
</html>
